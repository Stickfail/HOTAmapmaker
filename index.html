<!DOCTYPE html>
<html>

<head>
  <style>
    .grid-container {
      display: grid;
      grid-template-columns: repeat(4, minmax(32px, 32px));
      background-color: #2196F3;
      padding: 1px;
    }

    .grid-container>div {
      display: flex;
      align-items: center;
      justify-content: center;
      aspect-ratio: 1 / 1;
    }

    .palette {
      display: flex;
      margin-bottom: 10px;
    }

    .palette-item {
      width: 32px;
      height: 32px;
      margin-right: 5px;
      cursor: pointer;
    }

    .d0 {
      background-color: white;
    }

    .d1 {
      background-color: black;
    }

    .d2 {
      background-color: red;
    }

    .d3 {
      background-color: green;
    }

    .d4 {
      background-color: blue;
    }

    .selected {
      border: 2px solid yellow;
    }
  </style>
</head>

<body>

  <h1>HOTA Map Editor</h1>

  <div class="palette">
    <div class="palette-item d0" onclick="selectTile('d0')"></div>
    <div class="palette-item d1" onclick="selectTile('d1')"></div>
    <div class="palette-item d2" onclick="selectTile('d2')"></div>
    <div class="palette-item d3" onclick="selectTile('d3')"></div>
    <div class="palette-item d4" onclick="selectTile('d4')"></div>
  </div>

  <button type="button" onclick="resize()">Resize</button>

  <div class="grid-container" id="grid"></div>

  <button type="button" onclick="finish()">Finish</button>

  <p id="printid"></p>

  <script>
    const grid = document.getElementById("grid");
    let isDragging = false; // Track if the mouse is being dragged
    let currentTileId = "d0"; // Default class to start with

    // Function to select a tile from the palette
    function selectTile(tileId) {
      currentTileId = tileId;

      // Clear previous selection
      document.querySelectorAll('.palette-item').forEach(item => {
        item.classList.remove('selected');
      });

      // Add the 'selected' class to the currently selected tile
      document.querySelector(`.palette-item.${tileId}`).classList.add('selected');
    }

    // Function to change the tile's class (and color)
    function changeTileClass(tile) {
      tile.className = `tiles ${currentTileId}`; // Set tile to the current tile ID
    }

    function finish() {
  let final = [];

  for (let h = 0; h < y; h++) {
    let temp = [];
    for (let w = 0; w < x; w++) {
      let tile = document.getElementById(`${w}w${h}h`);
      let tileClass = tile.className.split(" ").pop(); // Get the tileType, e.g., "d0", "d1"
      temp.push({
        tileType: tileClass,
        class: tile.className,
        features: [] // Placeholder for future use
      });
    }
    final.push(temp);
  }

  document.getElementById("printid").innerText = JSON.stringify(final, null, 2); // Pretty-print the output
}


    let x, y;

    // Handle clicking to change tile class
    function handleClick(e) {
      if (e.target.classList.contains("tiles")) {
        changeTileClass(e.target); // Change clicked tile to the selected class
      }
    }

    // Handle mouse down event to start dragging
    function handleMouseDown(e) {
      if (e.target.classList.contains("tiles")) {
        isDragging = true;
        changeTileClass(e.target); // Change the first tile
      }
    }

    // Handle mouse up event to stop dragging
    function handleMouseUp() {
      isDragging = false; // Stop dragging
    }

    // Handle mouse over event to change tiles while dragging
    function handleMouseOver(e) {
      if (isDragging && e.target.classList.contains("tiles")) {
        changeTileClass(e.target); // Change tiles as you drag over them
      }
    }

    function resize() {
      x = prompt("Set x value");
      y = prompt("Set y value");

      grid.innerHTML = "";
      for (let h = 0; h < y; h++) {
        for (let w = 0; w < x; w++) {
          let space = document.createElement("div");
          space.className = "tiles d0"; // Default to d0 (white)
          space.id = `${w}w${h}h`;
          grid.appendChild(space);
        }
      }

      grid.style.gridTemplateColumns = `repeat(${x}, minmax(32px, 32px))`;
      grid.style.gridTemplateRows = `repeat(${y}, minmax(32px, 32px))`;

      // Add event listeners for mouse events
      grid.addEventListener("click", handleClick);
      grid.addEventListener("mousedown", handleMouseDown);
      grid.addEventListener("mouseup", handleMouseUp);
      grid.addEventListener("mouseover", handleMouseOver);
    }

    // Set default selected tile on page load
    window.onload = function () {
      selectTile('d0');
    }
  </script>
</body>

</html>
